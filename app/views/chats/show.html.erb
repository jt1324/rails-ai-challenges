<%= link_to "â† #{@chat.challenge.name}", challenge_path(@chat.challenge) %>

<h1 id="chat_title"><%= @chat.title %></h1>

<% @chat.messages.each do |message| %>
  <p>
    <strong><%= message.role %></strong>
    <%= raw(render_markdown(message.content)) %>
  </p>
<% end %>

<div id="new_message_container">
  <%= simple_form_for [@chat, @message] do |f| %>
    <%= f.input :content, label: "Ask a question", required: true, placeholder: "How should I get started with the challenge?" %>
    <%= f.input :file, as: :file, label: "Upload a file (PDF, image, or audio)" %>
    <%= f.button :submit, 'Ask LLM', class: 'btn btn-primary' %>
  <% end %>
</div>

<div id="messages">
  <% @chat.messages.each do |message| %>
    <% if message.role == "user" %>
      <div>
        <div class="d-flex justify-content-end mb-2">
          <div class="bg-white px-3 pb-0 pt-3 rounded-pill">
            <%= raw(render_markdown(message.content)) %>
          </div>

          <% if message.file.attached? %>
            <div class="ps-3 pt-1">
              <strong>File:</strong>
              <%= link_to message.file.filename, rails_blob_path(message.file, disposition: "attachment") %>
            </div>
          <% end %>

        </div>
      </div>
    <% elsif message.role == "assistant" %>
      <div class="d-flex justify-content-start mb-5">
        <div class="px-3 pb-0 pt-3">
          <%= raw(render_markdown(message.content)) %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
